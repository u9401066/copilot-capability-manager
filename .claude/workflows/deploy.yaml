# /cp.deploy å·¥ä½œæµç¨‹
# å®Œæ•´çš„éƒ¨ç½²æµç¨‹ï¼šæ¸¬è©¦ â†’ Git â†’ CI

workflow:
  id: deploy
  name: éƒ¨ç½²
  description: å®Œæ•´çš„æ¸¬è©¦ã€æäº¤å’Œéƒ¨ç½²æµç¨‹
  command: /cp.deploy
  
  # è§¸ç™¼è©
  triggers:
    - /cp.deploy
    - éƒ¨ç½²
    - deploy
    - ç™¼å¸ƒ
    
  # åƒæ•¸
  parameters:
    message:
      description: Commit è¨Šæ¯
      required: false
      default: auto
    skip_tests:
      description: è·³éæ¸¬è©¦
      required: false
      default: false
    branch:
      description: ç›®æ¨™åˆ†æ”¯
      required: false
      default: main
      
  # åŸ·è¡Œæ­¥é©Ÿ
  steps:
    - step: 1
      skill: project-tester
      name: åŸ·è¡Œæ¸¬è©¦
      description: ç¢ºä¿æ‰€æœ‰æ¸¬è©¦é€šé
      condition: "!{{skip_tests}}"
      input:
        coverage: true
      output: test_results
      abort_on_fail: true
      
    - step: 2
      skill: project-checker
      name: å°ˆæ¡ˆæª¢æŸ¥
      description: æª¢æŸ¥å°ˆæ¡ˆç‹€æ…‹
      input:
        scope: quick
      output: check_results
      
    - step: 3
      skill: memory-updater
      name: Memory Bank åŒæ­¥
      description: ç¢ºä¿ Memory Bank æ›´æ–°
      input:
        force: true
      output: memory_status
      
    - step: 4
      skill: git-precommit
      name: æäº¤å‰æº–å‚™
      description: åŸ·è¡Œæäº¤å‰æª¢æŸ¥
      input:
        quick: true
      output: precommit_status
      
    - step: 5
      skill: git-pusher
      name: Git æ¨é€
      description: æäº¤ä¸¦æ¨é€åˆ°é ç«¯
      input:
        message: "{{message}}"
        branch: "{{branch}}"
      output: push_results
      
    - step: 6
      skill: temp-cleaner
      name: æ¸…ç†
      description: æ¸…ç†è‡¨æ™‚æª”æ¡ˆ
      input:
        scope: build
      output: clean_results
      
  # è¼¸å‡º
  output:
    type: summary
    format: |
      ğŸš€ éƒ¨ç½²å®Œæˆ
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
      {{#if test_results}}
      ğŸ§ª æ¸¬è©¦ï¼š{{test_results.summary}}
      {{/if}}
      
      ğŸ“‹ æª¢æŸ¥ï¼š{{check_results.grade}}
      
      ğŸ“ Commitï¼š{{push_results.commit_hash}}
      
      ğŸ”— CIï¼š{{push_results.ci_url}}
      
      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      
  # å¾ŒçºŒå»ºè­°
  followup:
    - "æŸ¥çœ‹ CI åŸ·è¡Œç‹€æ…‹"
    - "å»ºç«‹ Release Tag"
